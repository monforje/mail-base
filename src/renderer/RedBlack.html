<!DOCTYPE html>
<html>
  <head>
    <title>Red/Black Tree Visualization</title>

    <!-- css sheet for how the page is laid out -->

    <link rel="stylesheet" href="visualizationPageStyle.css" />

    <!-- jqueury stuff.  Only used for the animation speed slider. -->
    <link rel="stylesheet" href="ThirdParty/jquery-ui-1.8.11.custom.css" />
    <script src="ThirdParty/jquery-1.5.2.min.js"></script>
    <script src="ThirdParty/jquery-ui-1.8.11.custom.min.js"></script>

    <!-- Javascript for the actual visualization code -->
    <script
      type="text/javascript"
      src="AnimationLibrary/CustomEvents.js"
    ></script>
    <script
      type="text/javascript"
      src="AnimationLibrary/UndoFunctions.js"
    ></script>
    <script
      type="text/javascript"
      src="AnimationLibrary/AnimatedObject.js"
    ></script>
    <script
      type="text/javascript"
      src="AnimationLibrary/AnimatedLabel.js"
    ></script>
    <script
      type="text/javascript"
      src="AnimationLibrary/AnimatedCircle.js"
    ></script>
    <script
      type="text/javascript"
      src="AnimationLibrary/AnimatedRectangle.js"
    ></script>
    <script
      type="text/javascript"
      src="AnimationLibrary/AnimatedLinkedList.js"
    ></script>
    <script
      type="text/javascript"
      src="AnimationLibrary/HighlightCircle.js"
    ></script>
    <script type="text/javascript" src="AnimationLibrary/Line.js"></script>
    <script
      type="text/javascript"
      src="AnimationLibrary/ObjectManager.js"
    ></script>
    <script
      type="text/javascript"
      src="AnimationLibrary/AnimationMain.js"
    ></script>

    <script type="text/javascript" src="AlgorithmLibrary/Algorithm.js"></script>
    <script type="text/javascript" src="AlgorithmLibrary/RedBlack.js"></script>
    <script>
      window.initialPackages = [
        {
          senderPhone: 1234567890,
          receiverPhone: 9876543210,
          weight: 2.5,
          date: "2025-07-12",
        },
        {
          senderPhone: 1112223333,
          receiverPhone: 4445556666,
          weight: 1.2,
          date: "2025-07-11",
        },
        // …
      ];
    </script>
    <script type="module" src="./usePackages.js"></script>
    <script type="module" src="./insertPackages.js"></script>
    <script>
      (function () {
        // обёртка, чтобы не засорять глобалы
        if (typeof window.init !== "function") {
          console.error("init() не найдено");
          return;
        }
        // Перехватываем оригинальный init
        const originalInit = window.init;
        window.init = function () {
          // 1) вызываем штатную инициализацию дерева
          originalInit();

          // 2) теперь вставляем все ключи из initialPackages
          if (
            !Array.isArray(window.initialPackages) ||
            !window.initialPackages.length
          ) {
            console.warn("initialPackages пуст или не массив");
            return;
          }
          // Для каждого пакета вызываем insertElement и сразу рисуем
          window.initialPackages.forEach((pkg) => {
            const key = pkg.senderPhone.toString();
            // возвращает список команд для одного узла
            const cmds = currentAlg.insertElement(key);
            // прогоняем анимацию сразу
            currentAlg.animationManager.StartNewAnimation(cmds);
            currentAlg.animationManager.skipForward();
            currentAlg.animationManager.clearHistory();
          });
        };
      })();
    </script>
  </head>

  <body onload="init();" class="VisualizationMainPage">
    <div id="container">
      <div id="header">
        <h1>Red/Black Tree</h1>
      </div>

      <div id="mainContent">
        <div id="algoControlSection">
          <!-- Table for buttons to control specific animation (insert/find/etc) -->
          <!-- (filled in by javascript code specific to the animtion) -->
          <table id="AlgorithmSpecificControls"></table>
        </div>

        <!-- Drawing canvas where all animation is done.  Note:  can be resized in code -->

        <canvas id="canvas" width="1000" height="500"></canvas>

        <div id="generalAnimationControlSection">
          <table id="GeneralAnimationControls"></table>
        </div>
      </div>

      <div id="footer">
        <p><a href="Algorithms.html">Algorithm Visualizations</a></p>
      </div>
    </div>
    <!-- container -->
  </body>
</html>
